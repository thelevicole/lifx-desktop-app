<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>LIFX Desktop Application</title>
	<link rel="stylesheet" href="./css/app.css">
</head>
<body>

	<div vue-app>

		<header>
			<span v-if="controlling">{{ controlling.label || controlling.name }}</span>
			<img v-if="!controlling" src="./images/logo.svg" alt="LIFX" width="52" height="20">
			<a v-on:click.prevent="logout" v-if="access_token && lights.length">Logout</a>
		</header>

		<!-- Auth form -->
		<div v-if="!access_token || !lights.length">
			<form v-on:submit.prevent="authenticate">
				<h3>An access token is required</h3>
				<p>You can generate personal access tokens from your <a href="https://cloud.lifx.com/settings" target="_blank">LIFX Cloud</a> account.</p>
				<input type="text" v-model="access_token">
				<button class="btn">Connect</button>
			</form>
		</div>

		<!-- If we have the users access token -->
		<div v-if="access_token && lights.length">

			<!-- List all lights -->
			<div v-if="!controlling">
				<div id="bulbs" class="text-center" v-if="lights.length">
					<h1>Lights</h1>
					<!-- <group-switch :lights="{id: 'all', name: 'All Lights', lights: lights}"></group-switch> -->
					<light-switch v-for="light in ordered_lights" :key="light.id" :data="light"></light-switch>
					<h1>Groups</h1>
					<group-switch v-for="group in ordered_groups" :key="group.id" :group="group"></group-switch>
				</div>
				<h1 v-if="!lights.length" class="text-center text-white">Loading...</h1>
			</div>

			<!-- Show single light -->
			<div v-if="controlling">
				<color-picker></color-picker>
			</div>

		</div>
	</div>

	<script type="text/x-template" id="group-switch-template">
		<div class="switch" v-if="group.lights.length">
			<button class="toggle-power" v-on:click="toggle()">
				<strong>{{ group.lights.length }}</strong>
				<svg viewBox="0 0 36 36" class="svg">
					<circle class="base" cx="18" cy="18" r="16"></circle>
					<path class="progress" :stroke="hex_color" stroke-dasharray="100, 100" stroke-linecap="round" d="M18 2 a 16 16 0 0 1 0 32 a 16 16 0 0 1 0 -32"></path>
					<path d="M19.8461538,21.3076923 L19.8461538,22.8461538 C19.8461538,23.0160876 19.7083953,23.1538462 19.5384615,23.1538462 L19.3158133,23.5991426 C19.2636927,23.7033839 19.1571502,23.7692308 19.0406049,23.7692308 L16.9593951,23.7692308 C16.8428498,23.7692308 16.7363073,23.7033839 16.6841867,23.5991426 L16.4615385,23.1538462 C16.2916047,23.1538462 16.1538462,23.0160876 16.1538462,22.8461538 L16.1538462,21.3076923 L13.3531545,17.8668425 C13.1744786,17.6473264 13.0769231,17.3729344 13.0769231,17.0898931 L13.0769231,13 C13.0769231,12.8300662 13.2146816,12.6923077 13.3846154,12.6923077 L22.6153846,12.6923077 C22.7853184,12.6923077 22.9230769,12.8300662 22.9230769,13 L22.9230769,17.0898931 C22.9230769,17.3729344 22.8255214,17.6473264 22.6468455,17.8668425 L19.8461538,21.3076923 Z M21.3106738,22.8461538 L24.5184998,18.6236073 C24.6811656,18.4094861 24.7692308,18.1479837 24.7692308,17.8790821 L24.7692308,13.8461538 L25.75,13.8461538 C25.8880712,13.8461538 26,13.9580827 26,14.0961538 L26,17.419192 C26,17.6491631 25.9207362,17.8721066 25.775562,18.0504634 L23.5,20.8461538 L23.5,22.0961538 C23.5,22.234225 23.3880712,22.3461538 23.25,22.3461538 L23.0690983,22.7079572 C23.0267503,22.7926533 22.9401845,22.8461538 22.8454915,22.8461538 L21.3106738,22.8461538 Z M11.2307692,13.8461538 L11.2307692,17.8790821 C11.2307692,18.1479837 11.3188344,18.4094861 11.4815002,18.6236073 L14.6893262,22.8461538 L13.1545085,22.8461538 C13.0598155,22.8461538 12.9732497,22.7926533 12.9309017,22.7079572 L12.75,22.3461538 C12.6119288,22.3461538 12.5,22.234225 12.5,22.0961538 L12.5,20.8461538 L10.224438,18.0504634 C10.0792638,17.8721066 10,17.6491631 10,17.419192 L10,14.0961538 C10,13.9580827 10.1119288,13.8461538 10.25,13.8461538 L11.2307692,13.8461538 Z M21.6923077,25.3461538 L23.25,25.3461538 L23.0690983,25.7079572 C23.0267503,25.7926533 22.9401845,25.8461538 22.8454915,25.8461538 L21.6923077,25.8461538 L21.6923077,25.3461538 Z M21.6923077,23.3461538 L23.25,23.3461538 C23.3880712,23.3461538 23.5,23.4580827 23.5,23.5961538 C23.5,23.734225 23.3880712,23.8461538 23.25,23.8461538 L21.6923077,23.8461538 L21.6923077,23.3461538 Z M21.6923077,24.3461538 L23.25,24.3461538 C23.3880712,24.3461538 23.5,24.4580827 23.5,24.5961538 C23.5,24.734225 23.3880712,24.8461538 23.25,24.8461538 L21.6923077,24.8461538 L21.6923077,24.3461538 Z M11.2307692,13.3461538 L10.25,13.3461538 C10.1119288,13.3461538 10,13.234225 10,13.0961538 L10,11.0961538 C10,10.9580827 10.1119288,10.8461538 10.25,10.8461538 L11.2307692,10.8461538 L11.2307692,13.3461538 Z M24.7692308,10.8461538 L25.75,10.8461538 C25.8880712,10.8461538 26,10.9580827 26,11.0961538 L26,13.0961538 C26,13.234225 25.8880712,13.3461538 25.75,13.3461538 L24.7692308,13.3461538 L24.7692308,10.8461538 Z M14.3076923,25.3461538 L14.3076923,25.8461538 L13.1545085,25.8461538 C13.0598155,25.8461538 12.9732497,25.7926533 12.9309017,25.7079572 L12.75,25.3461538 L14.3076923,25.3461538 Z M14.3076923,23.3461538 L14.3076923,23.8461538 L12.75,23.8461538 C12.6119288,23.8461538 12.5,23.734225 12.5,23.5961538 C12.5,23.4580827 12.6119288,23.3461538 12.75,23.3461538 L14.3076923,23.3461538 Z M14.3076923,24.3461538 L14.3076923,24.8461538 L12.75,24.8461538 C12.6119288,24.8461538 12.5,24.734225 12.5,24.5961538 C12.5,24.4580827 12.6119288,24.3461538 12.75,24.3461538 L14.3076923,24.3461538 Z M16.4615385,26.8461538 L19.5384615,26.8461538 L19.3158133,27.2914503 C19.2636927,27.3956916 19.1571502,27.4615385 19.0406049,27.4615385 L16.9593951,27.4615385 C16.8428498,27.4615385 16.7363073,27.3956916 16.6841867,27.2914503 L16.4615385,26.8461538 Z M16.4615385,24.3846154 L19.5384615,24.3846154 C19.7083953,24.3846154 19.8461538,24.5223739 19.8461538,24.6923077 C19.8461538,24.8622415 19.7083953,25 19.5384615,25 L16.4615385,25 C16.2916047,25 16.1538462,24.8622415 16.1538462,24.6923077 C16.1538462,24.5223739 16.2916047,24.3846154 16.4615385,24.3846154 Z M16.4615385,25.6153846 L19.5384615,25.6153846 C19.7083953,25.6153846 19.8461538,25.7531432 19.8461538,25.9230769 C19.8461538,26.0930107 19.7083953,26.2307692 19.5384615,26.2307692 L16.4615385,26.2307692 C16.2916047,26.2307692 16.1538462,26.0930107 16.1538462,25.9230769 C16.1538462,25.7531432 16.2916047,25.6153846 16.4615385,25.6153846 Z M13.3846154,9 L22.6153846,9 C22.7853184,9 22.9230769,9.13775854 22.9230769,9.30769231 L22.9230769,11.7692308 C22.9230769,11.9391645 22.7853184,12.0769231 22.6153846,12.0769231 L13.3846154,12.0769231 C13.2146816,12.0769231 13.0769231,11.9391645 13.0769231,11.7692308 L13.0769231,9.30769231 C13.0769231,9.13775854 13.2146816,9 13.3846154,9 Z" class="icon" :fill="hex_color" fill-rule="nonzero"></path>
					<text font-size="6" font-weight="bold" fill="#000002">
						<tspan x="18" y="18" text-anchor="middle">{{ group.lights.length }}</tspan>
					</text>
				</svg>
				<div class="glow" :style="{background: hex_color}"></div>
			</button>
			<button class="goto-single btn" v-on:click="set()">{{ group.name }}</button>
		</div>
	</script>

	<script type="text/x-template" id="light-switch-template">
		<div class="switch" v-if="data">
			<button class="toggle-power" v-on:click="toggle()">
				<svg viewBox="0 0 36 36" class="svg">
					<circle class="base" cx="18" cy="18" r="16"></circle>
					<path class="progress" :stroke="hex_color" :stroke-dasharray="percentage" :stroke-linecap="linecap" d="M18 2 a 16 16 0 0 1 0 32 a 16 16 0 0 1 0 -32"></path>
					<path d="M16.5,13.8327556 L16.5,14.9325233 C15.3105492,15.56127 14.5,16.810978 14.5,18.25 C14.5,20.3210678 16.1789322,22 18.25,22 C20.3210678,22 22,20.3210678 22,18.25 C22,16.810978 21.1894508,15.56127 20,14.9325233 L20,13.8327556 C21.75731,14.5295445 23,16.2446494 23,18.25 C23,20.8733526 20.8733526,23 18.25,23 C15.6266474,23 13.5,20.8733526 13.5,18.25 C13.5,16.2446494 14.74269,14.5295445 16.5,13.8327556 Z M17.75,13.5 L18.75,13.5 L18.75,18 L17.75,18 L17.75,13.5 Z" class="icon" :fill="hex_color" fill-rule="nonzero"></path>
				</svg>
				<div class="glow" :style="{background: hex_color}"></div>
			</button>
			<button class="goto-single btn" v-on:click="set()">{{ data.label }}</button>
		</div>
	</script>

	<script type="text/x-template" id="color-picker-template">
		<div class="color-picker" :class="['power-'+single.power]">
			<button class="close btn" v-on:click="close()" style="position: relative; z-index: 999;">&laquo; Go back</button>
			<div class="inner">
				<div class="dial"></div>
				<div class="controls">
					<div class="color">
						<div class="handle"></div>
					</div>
					<div class="brightness">
						<div class="handle">
							<i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
						</div>
					</div>
				</div>
			</div>
		</div>
	</script>

	<script>
		window.jQuery	= window.$ = require('./js/jquery.js');
		window._		= require('./js/lodash.js');
		window.Vue		= require('./js/vue.js');
		window.Lifx		= require('./js/lifx.js');
		require('./renderer.js');
		require('./js/color-picker.js');
		require('./js/app.js');
	</script>
</body>
</html>
