"use strict";!function(t){var e=!1,o=new Vue({el:"[vue-app]",data:{access_token:localStorage.getItem("lifx_access_token"),lights:[],groups:[],controlling:!1},mounted:function(){this.authenticate()},methods:{order_by:function(t,e){return _.orderBy(t||[],e)},authenticate:function(){var o=this;this.access_token?(localStorage.setItem("lifx_access_token",this.access_token),e=new Lifx(this.access_token),t(this.$el).addClass("loading"),e.list_lights().then(function(e){t(o.$el).removeClass("loading"),o.lights=e,o.group_builder()},function(e){t(o.$el).removeClass("loading"),e.error&&alert(e.error)})):(localStorage.removeItem("lifx_access_token"),e=!1)},logout:function(){localStorage.removeItem("lifx_access_token"),e=!1,location.reload()},group_builder:function(){var t=this,e=[];if(this.lights)for(var o=function(){var o=t.lights[i];o.group&&(r=_.findIndex(e,{id:o.group.id}),n={id:o.group.id,name:o.group.name,power:o.power,lights:_.values(_.filter(t.lights,function(t){return t.group.id===o.group.id}))},-1!==r?"on"===o.power&&(e[r].power="on"):e.push(n))},i=0;i<this.lights.length;i++){var r,n;o()}this.groups=e},update_light:function(t,e){if("all"===t)for(var o=0;o<this.lights.length;o++)this.lights[o]=this.update_light(this.lights[o].id,e);else{var i=this.get_light(t);i?(this.lights[i.index]=_.extend(!0,i.data,e||{}),console.log("update single light",t)):console.warn("light not found",t)}this.group_builder()},get_light:function(t,e){var o=_.findIndex(this.lights,{id:t});if(o>=0){var i={index:o,data:this.lights[o]};return e?i[e]:i}return!!e&&null},update_group_lights:function(t,e){var o=this.get_group(t);if(o&&o.lights)for(var i=0;i<o.lights.length;i++)this.update_light(o.lights[i].id,e)},get_group:function(t){return _.find(this.groups,{id:t},!1)},update_view_data:function(t,e){"all"===t||this.get_light(t)?this.update_light(t,e):this.get_group(t)&&this.update_group_lights(t,e)}}});Vue.component("group-switch",{props:["group"],template:"#group-switch-template",computed:{selector:function(){return"all"!==this.group.id?"group_id:"+this.group.id:"all"},hex_color:function(){return"on"===this.group.power?"#00A6FF":"#3B434B"}},methods:{toggle:function(){return this.group.power="on"===this.group.power?"off":"on",e.set_state(this.selector,{power:this.group.power}),o.update_view_data(this.group.id,{power:this.group.power}),!1},set:function(){return o.controlling={title:this.group.name,selector:"group_id",id:this.group.id,data:this.group.lights},!1}}}),Vue.component("light-switch",{props:["data"],template:"#light-switch-template",computed:{percentage:function(){return"on"===this.data.power?100*this.data.brightness+", 100":"0, 100"},linecap:function(){return"on"===this.data.power?"round":"butt"},hex_color:function(){var t,e,o=this.data.color.hue,i=this.data.color.saturation,r=[];if(0===i)t=[1,1,1];else switch(r=[1*(1-i),1*(1-i*((o/=60)-(e=Math.floor(o)))),1*(1-i*(1-(o-e)))],e){case 0:t=[1,r[2],r[0]];break;case 1:t=[r[1],1,r[0]];break;case 2:t=[r[0],1,r[2]];break;case 3:t=[r[0],r[1],1];break;case 4:t=[r[2],r[0],1];break;default:t=[1,r[0],r[1]]}return"#"+t.map(function(t){return("0"+Math.round(255*t).toString(16)).slice(-2)}).join("")}},methods:{toggle:function(){return this.data.power="on"===this.data.power?"off":"on",e.set_state("id:"+this.data.id,{power:this.data.power}),o.update_view_data(this.data.id,{power:this.data.power}),!1},set:function(){return o.controlling={title:this.data.label,selector:"id",id:this.data.id,data:this.data},!1}}}),Vue.component("color-picker",{template:"#color-picker-template",methods:{close:function(){return o.controlling=!1,!1}},computed:{single:function(){return o.controlling.data.brightness?o.controlling.data:o.controlling.data[0]}},mounted:function(){var i=this.single,r=!1,n=o.controlling.selector+":"+o.controlling.id,s=o.controlling.id;t(this.$el).LifxColorPicker({brightness:i.brightness,hue:i.color.hue,saturation:i.color.saturation,changed:function(t){r&&clearTimeout(r),r=setTimeout(function(){e.set_color(n,t.hue,t.saturation,t.brightness),o.update_view_data(s,{color:{hue:t.hue,saturation:t.saturation},brightness:t.brightness,power:i.power})},500)}})}})}(jQuery);